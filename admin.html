<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Admin - Réservations</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
    h1 { text-align:center; }
    .hidden { display:none; }
    table { border-collapse: collapse; margin:20px auto; width:90%; background:#fff; }
    th,td { border:1px solid #ccc; padding:10px; text-align:center; }
    .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; margin:20px auto; max-width:500px; }
    .day { padding:20px; background:#fff; border:1px solid #ccc; cursor:pointer; }
    .reserved { background:#999; color:#fff; }
    button { padding:8px 15px; margin:5px; cursor:pointer; border:none; border-radius:5px; }
    .btn-red { background:red; color:white; }
    .btn-green { background:green; color:white; }
    .btn-blue { background:#0077ff; color:white; }
  </style>
</head>
<body>

<h1>Panel Administrateur</h1>

<!-- Connexion admin -->
<div id="loginDiv">
  <h2>Connexion</h2>
  <input type="text" id="loginUser" placeholder="Nom d'utilisateur"><br>
  <input type="password" id="loginPass" placeholder="Mot de passe"><br>
  <button class="btn-green" onclick="login()">Se connecter</button>
</div>

<!-- Partie admin -->
<div id="adminDiv" class="hidden">
  <h2>Réservations</h2>
  <button class="btn-blue" onclick="logout()">Déconnexion</button>
  <table>
    <thead>
      <tr>
        <th>Jour</th><th>Heure</th><th>Nom</th><th>Email</th><th>Message</th><th>Action</th>
      </tr>
    </thead>
    <tbody id="adminTable"></tbody>
  </table>

  <h2>Calendrier - Bloquer des jours</h2>
  <p>Cliquez sur un jour pour le bloquer/débloquer.</p>
  <div class="calendar" id="adminCalendar"></div>
</div>

<script>
let reservations = JSON.parse(localStorage.getItem('reservations')) || [];
let blockedDays = JSON.parse(localStorage.getItem('blockedDays')) || [];
const adminUser = {username:"admin", password:"admin"};

// --- Connexion admin ---
function login(){
  const u=document.getElementById('loginUser').value;
  const p=document.getElementById('loginPass').value;
  if(u===adminUser.username && p===adminUser.password){
    document.getElementById('loginDiv').classList.add('hidden');
    document.getElementById('adminDiv').classList.remove('hidden');
    generateAdminTable();
    generateAdminCalendar();
  } else {
    alert("Identifiants incorrects !");
  }
}

// --- Déconnexion ---
function logout(){
  document.getElementById('adminDiv').classList.add('hidden');
  document.getElementById('loginDiv').classList.remove('hidden');
  document.getElementById('loginUser').value="";
  document.getElementById('loginPass').value="";
}

// --- Table des réservations ---
function generateAdminTable(){
  const tbody=document.getElementById('adminTable');
  tbody.innerHTML="";
  reservations.forEach((r,index)=>{
    if(r.annule) return; // masquer si annulé
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${r.jour}</td>
      <td>${r.heure}</td>
      <td>${r.nom}</td>
      <td>${r.email}</td>
      <td>${r.message||""}</td>
      <td><button class="btn-red" onclick="adminCancel(${index})">Annuler</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// --- Annuler une réservation ---
function adminCancel(index){
  if(confirm("Voulez-vous annuler cette réservation ?")){
    reservations[index].annule=true;
    localStorage.setItem('reservations',JSON.stringify(reservations));
    generateAdminTable();
    generateAdminCalendar();
    alert("Réservation annulée !");
  }
}

// --- Calendrier admin (bloquer jours) ---
function generateAdminCalendar(){
  const adminCalendar=document.getElementById('adminCalendar');
  adminCalendar.innerHTML="";
  for(let day=1; day<=30; day++){
    const div=document.createElement('div');
    div.textContent=day;
    div.className='day';

    if(blockedDays.includes(day)){
      div.classList.add('reserved');
      div.title="Jour bloqué";
    }

    div.addEventListener('click', ()=>{
      if(blockedDays.includes(day)){
        blockedDays=blockedDays.filter(d=>d!==day);
      } else {
        blockedDays.push(day);
      }
      localStorage.setItem('blockedDays',JSON.stringify(blockedDays));
      generateAdminCalendar();
    });

    adminCalendar.appendChild(div);
  }
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Réservation Piscine Shadi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h2 {
      margin-bottom: 10px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      max-width: 600px;
      margin: 20px auto;
    }
    .day {
      padding: 20px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
    }
    .day.reserved { background: #ccc; color: #666; cursor:not-allowed; }
    .day.blocked { background: #444; color: #fff; cursor:not-allowed; }
    .day:hover { background: #cce5ff; }

    /* Grille des horaires */
    #timeSlots { margin-top:20px; }
    #timeGrid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      max-width: 400px;
      margin: 0 auto;
    }
    .slot {
      padding: 20px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      cursor: pointer;
    }
    .slot:hover { background:#cce5ff; }
    .slot.reserved { background:#ccc; color:#666; cursor:not-allowed; }
    .slot.selected { border:2px solid #0077ff; }

    form {
      margin-top: 20px;
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
    input, textarea, button {
      display:block;
      width:100%;
      margin:10px 0;
      padding:10px;
    }
    button { background:red; color:white; border:none; cursor:pointer; border-radius:6px; }
  </style>
</head>
<body>
  <h2>Réserver une séance</h2>
  <p>Cliquez sur un jour puis choisissez un horaire disponible.</p>
  <div id="calendar" class="calendar"></div>

  <div id="timeSlots" class="hidden">
    <h3>Choisissez un horaire</h3>
    <div id="timeGrid"></div>
  </div>

  <form id="reservationForm">
    <input type="text" id="nom" placeholder="Votre nom" required>
    <input type="email" id="email" placeholder="Votre email" required>
    <textarea id="message" placeholder="Message (optionnel)"></textarea>
    <input type="text" id="selectedDate" readonly>
    <button type="submit">Réserver</button>
  </form>

  <p>Pour tout contact direct : <b>shadi.siteweb@gmail.com</b></p>

  <script>
    let reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
    let blockedDays = JSON.parse(localStorage.getItem("blockedDays") || "[]");

    let selectedDay = null;
    let selectedHour = null;

    function generateCalendar(){
      const cal=document.getElementById('calendar');
      cal.innerHTML="";
      for(let d=1;d<=30;d++){
        const div=document.createElement('div');
        div.textContent=d;
        div.className="day";

        if(blockedDays.includes(d)){
          div.classList.add("blocked");
        }
        if(reservations.some(r=>r.jour===d && !r.annule)){
          div.classList.add("reserved");
        }

        div.addEventListener('click', ()=>{
          if(div.classList.contains("blocked")) return;
          showTimeSlots(d);
        });

        cal.appendChild(div);
      }
    }

    function showTimeSlots(day){
      selectedDay=null;
      selectedHour=null;
      const container=document.getElementById("timeSlots");
      const grid=document.getElementById("timeGrid");
      container.classList.remove("hidden");
      grid.innerHTML="";

      const slots=[
        "09:00-10:00",
        "10:30-11:30",
        "12:00-13:00",
        "13:30-14:30",
        "15:00-16:00"
      ];

      slots.forEach(hour=>{
        const div=document.createElement('div');
        div.textContent=hour;
        div.className="slot";

        const reserved=reservations.find(r=>r.jour===day && r.heure===hour && !r.annule);
        if(reserved){
          div.classList.add("reserved");
        } else {
          div.addEventListener("click",()=>{
            document.querySelectorAll(".slot").forEach(s=>s.classList.remove("selected"));
            div.classList.add("selected");
            selectedDay=day;
            selectedHour=hour;
            document.getElementById("selectedDate").value=`Jour ${day} - ${hour}`;
          });
        }
        grid.appendChild(div);
      });
    }

    document.getElementById("reservationForm").addEventListener("submit",e=>{
      e.preventDefault();
      const nom=document.getElementById("nom").value;
      const email=document.getElementById("email").value;
      const message=document.getElementById("message").value;

      if(!selectedDay || !selectedHour){
        alert("Veuillez choisir un jour et un horaire.");
        return;
      }

      reservations.push({jour:selectedDay, heure:selectedHour, nom,email,message, annule:false});
      localStorage.setItem("reservations",JSON.stringify(reservations));

      alert("Réservation confirmée !");
      generateCalendar();
      document.getElementById("reservationForm").reset();
      document.getElementById("selectedDate").value="";
      document.getElementById("timeSlots").classList.add("hidden");
    });

    generateCalendar();
  </script>
</body>
</html>

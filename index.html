<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Shadi Piscine - R√©servation & Admin</title>
<style>
body { font-family: Arial; transition:0.3s; background:#f4f4f4; color:#000; }
.dark-mode { background:#121212; color:#fff; }
.container { max-width:600px; margin:auto; padding:20px; }
input, button, textarea, select { width:100%; padding:10px; margin:6px 0; border-radius:8px; border:1px solid #ccc; }
button { border:none; cursor:pointer; border-radius:5px; }
button:hover { opacity:0.9; }
button.logoutBtn { background:#ff5555; color:white; }
button.createBtn { background:#00aa55; color:white; }
button.loginBtn { background:#ff3333; color:white; }
button.cancelBtn { background:#ff9900; color:white; }
.hidden { display:none; }
.calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:5px; margin:10px 0; }
.day { padding:20px; text-align:center; border-radius:8px; border:1px solid #ccc; cursor:pointer; background:white; }
.day:hover { background:#cce5ff; }
.day.reserved { background:#ccc; color:#666; cursor:not-allowed; }
.attention { background:#ffdddd; border:1px solid #ff5c5c; padding:10px; border-radius:8px; font-weight:bold; color:#a80000; margin-bottom:15px; text-align:center; }
.contact { margin-top:20px; padding:10px; background:#e0f7ff; border:1px solid #00aaff; border-radius:8px; }
</style>
</head>
<body>

<!-- Connexion utilisateur/admin -->
<div class="container" id="loginDiv">
<h2>Connexion - Shadi Piscine</h2>
<label>Nom d'utilisateur :</label>
<input type="text" id="username">
<label>Mot de passe :</label>
<input type="password" id="password">
<button class="loginBtn" onclick="login()">Se connecter</button>
<button class="createBtn" onclick="showCreateDiv()">Cr√©er un compte</button>
<div id="loginError" style="color:red; display:none; margin-top:10px;">Nom ou mot de passe incorrect</div>
</div>

<!-- Cr√©ation compte -->
<div class="container hidden" id="createDiv">
<h2>Cr√©er un compte - Shadi Piscine</h2>
<label>Nom d'utilisateur :</label>
<input type="text" id="newUsername">
<label>Mot de passe :</label>
<input type="password" id="newPassword">
<button onclick="createAccount()">Cr√©er le compte</button>
<div id="createError" style="color:red; display:none; margin-top:10px;"></div>
</div>

<!-- Page utilisateur -->
<div class="container hidden" id="resaDiv">
<h2>Shadi Piscine - R√©servation</h2>
<button onclick="toggleMode()">üåô/‚òÄÔ∏è Mode sombre/blanc</button>
<button class="logoutBtn" onclick="logout()">D√©connexion</button>
<button id="cancelMyResaBtn" class="logoutBtn hidden" onclick="cancelMyReservation()">Annuler ma r√©servation</button>

<div class="attention">
‚ö†Ô∏è Attention, v√©rifiez bien vos informations avant d‚Äôenvoyer !
</div>

<h3>Calendrier</h3>
<div class="calendar" id="calendar"></div>

<form id="resaForm">
<label>Nom complet :</label>
<input type="text" name="Nom" required>

<label>Email :</label>
<input type="email" name="Email" required>

<label>Date choisie :</label>
<input type="text" id="selectedDate" name="Date" readonly required>

<label>Message :</label>
<textarea name="Message" rows="4"></textarea>

<button type="submit">R√©server</button>
</form>

<div class="contact">
Pour tout contact, veuillez envoyer un email √† <strong>shadi.siteweb@gmail.com</strong>
</div>
</div>

<!-- Page admin -->
<div class="container hidden" id="adminDiv">
<h2>Admin - R√©servations</h2>
<button onclick="toggleMode()">üåô/‚òÄÔ∏è Mode sombre/blanc</button>
<button class="logoutBtn" onclick="logout()">D√©connexion</button>

<h3>R√©servations</h3>
<table border="1" width="100%" style="border-collapse:collapse;">
<tr><th>Jour</th><th>Nom</th><th>Email</th><th>Message</th><th>Action</th></tr>
<tbody id="adminTable"></tbody>
</table>
</div>

<script>
// --- Comptes ---
let savedAccount = JSON.parse(localStorage.getItem('account'));
const adminUser = {username:"admin", password:"admin"}; // admin par d√©faut

function showCreateOrLogin(){
    if(savedAccount){
        document.getElementById('createDiv').classList.add('hidden');
        document.getElementById('loginDiv').classList.remove('hidden');
    } else {
        document.getElementById('createDiv').classList.remove('hidden');
        document.getElementById('loginDiv').classList.add('hidden');
    }
}

function showCreateDiv(){
    document.getElementById('loginDiv').classList.add('hidden');
    document.getElementById('createDiv').classList.remove('hidden');
}

function createAccount(){
    const u = document.getElementById('newUsername').value.trim();
    const p = document.getElementById('newPassword').value.trim();
    if(u===""||p===""){document.getElementById('createError').textContent="Veuillez remplir tous les champs";document.getElementById('createError').style.display="block";return;}
    savedAccount = {username:u,password:p};
    localStorage.setItem('account', JSON.stringify(savedAccount));
    alert("Compte cr√©√© !");
    showCreateOrLogin();
}

// --- Connexion ---
function login(){
    const u=document.getElementById('username').value;
    const p=document.getElementById('password').value;
    if(u===adminUser.username && p===adminUser.password){
        document.getElementById('loginDiv').classList.add('hidden');
        document.getElementById('adminDiv').classList.remove('hidden');
        generateAdminTable();
    } else if(savedAccount && u===savedAccount.username && p===savedAccount.password){
        document.getElementById('loginDiv').classList.add('hidden');
        document.getElementById('resaDiv').classList.remove('hidden');
        generateCalendar(u); // on passe l'utilisateur connect√©
    } else {
        document.getElementById('loginError').style.display='block';
    }
}

// --- D√©connexion ---
function logout(){
    document.getElementById('resaDiv').classList.add('hidden');
    document.getElementById('adminDiv').classList.add('hidden');
    document.getElementById('loginDiv').classList.remove('hidden');
}

// --- Mode sombre ---
function toggleMode(){ document.body.classList.toggle('dark-mode'); }

// --- R√©servations stock√©es ---
let reservations = JSON.parse(localStorage.getItem('reservations')) || [];
let selectedDay = null;
const calendar = document.getElementById('calendar');

// --- Calendrier utilisateur ---
function generateCalendar(userEmail){
    // V√©rifie les annulations pour cet utilisateur
    reservations.forEach((r,index)=>{
        if(r.annule && r.email === userEmail){
            alert(`Votre r√©servation pour le jour ${r.jour} a √©t√© annul√©e par l'admin !`);
            reservations.splice(index,1);
            localStorage.setItem('reservations',JSON.stringify(reservations));
        }
    });

    calendar.innerHTML="";
    for(let day=1;day<=30;day++){
        const div=document.createElement('div');
        div.textContent=day;
        div.className='day';
        if(reservations.find(r=>r.jour===day)){
            div.classList.add('reserved');
        } else {
            div.addEventListener('click',()=>{
                selectedDay=day;
                document.getElementById('selectedDate').value=`Jour ${day}`;
                document.querySelectorAll('.day').forEach(d=>d.style.border='1px solid #ccc');
                div.style.border='2px solid #0077ff';
            });
        }
        calendar.appendChild(div);
    }
    showCancelButton(userEmail);
}

// --- Formulaire r√©servation ---
document.getElementById('resaForm').addEventListener('submit',function(e){
    e.preventDefault();
    if(selectedDay===null){alert("Veuillez s√©lectionner un jour !");return;}
    if(confirm("Voulez-vous r√©server ce jour ?")){
        const nom=document.querySelector('input[name="Nom"]').value;
        const email=document.querySelector('input[name="Email"]').value;
        const message=document.querySelector('textarea[name="Message"]').value;
        reservations.push({jour:selectedDay,nom,email,message,annule:false});
        localStorage.setItem('reservations',JSON.stringify(reservations));
        alert("R√©servation confirm√©e ! Pour contact : shadi.siteweb@gmail.com");
        generateCalendar(email);
        this.reset();
        document.getElementById('selectedDate').value='';
        selectedDay=null;
    }
});

// --- Bouton annuler c√¥t√© client ---
function showCancelButton(userEmail){
    const myResa = reservations.find(r => r.email === userEmail && !r.annule);
    const btn = document.getElementById('cancelMyResaBtn');
    if(myResa){
        btn.classList.remove('hidden');
    } else {
        btn.classList.add('hidden');
    }
}

function cancelMyReservation(){
    const email = document.querySelector('input[name="Email"]').value;
    const index = reservations.findIndex(r => r.email === email && !r.annule);
    if(index !== -1){
        if(confirm(`Voulez-vous vraiment annuler votre r√©servation pour le jour ${reservations[index].jour} ?`)){
            reservations.splice(index,1);
            localStorage.setItem('reservations', JSON.stringify(reservations));
            alert("Votre r√©servation a √©t√© annul√©e !");
            generateCalendar(email);
            showCancelButton(email);
            document.getElementById('resaForm').reset();
            document.getElementById('selectedDate').value='';
            selectedDay = null;
        }
    } else {
        alert("Vous n'avez pas de r√©servation active !");
    }
}

// --- Admin ---
function generateAdminTable(){
    const tbody=document.getElementById('adminTable');
    tbody.innerHTML="";
    reservations.forEach((r,index)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${r.jour}</td><td>${r.nom}</td><td>${r.email}</td><td>${r.message}</td><td><button onclick="cancelReservation(${index})" class="cancelBtn">Annuler</button></td>`;
        tbody.appendChild(tr);
    });
}

function cancelReservation(index){
    if(confirm("Voulez-vous vraiment annuler cette r√©servation ?")){
        reservations[index].annule = true;
        localStorage.setItem('reservations',JSON.stringify(reservations));
        generateAdminTable();
        alert("R√©servation annul√©e ! Le client sera inform√© √† sa prochaine connexion.");
    }
}

// --- Initialisation ---
showCreateOrLogin();
</script>
</body>
</html>
